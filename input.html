<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>í†µë¹± ì§ì› í˜¸ì¶œ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 1vh 2vw;
      margin: 0;
      background-color: #fff;
      color: #333;
      height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      font-size: 6vw;
      font-weight: bold;
      color: #e91e63;
      margin-bottom: 1vh;
    }

    button, input {
      font-size: 4.5vw;
      padding: 1.2vh 0;
      margin: 0.3vh 0;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      box-sizing: border-box;
    }

    button {
      width: 100%;
    }

    .btn-orange {
      background-color: orange;
      color: white;
    }

    .btn-gray {
      background-color: #ccc;
      color: #333;
    }

    .btn-red {
      background-color: #ff4444;
      color: white;
    }

    .row {
      display: flex;
      gap: 1.5vw;
      align-items: center;
      width: 100%;
    }

    .input-short {
      width: 22%;
      font-size: 4.5vw;
      text-align: center;
      border: 2px solid #ccc;
    }

    .btn-flex {
      flex: 1;
    }

    #status {
      text-align: center;
      font-size: 5.5vw;
      color: #ff0000;
      font-weight: bold;
      margin: 1vh 0;
      padding: 1vh 2vw;
      min-height: 4vh;
      flex-shrink: 0;
      background-color: #ffe6e6;
      border-radius: 8px;
      border: 2px solid #ff6666;
    }

    #displayStatus {
      text-align: center;
      font-size: 4vw;
      font-weight: bold;
      min-height: 3vh;
      flex-shrink: 0;
      border-radius: 8px;
      padding: 0.5vh 1vw;
      margin-bottom: 0.5vh;
    }

    .status-connected {
      background-color: #d4edda;
      color: #155724;
    }

    .status-disconnected {
      background-color: #f8d7da;
      color: #721c24;
    }

    #currentNumbers {
      background-color: #f0f0f0;
      padding: 0.8vh 1.5vw;
      border-radius: 6px;
      margin: 0.3vh 0;
      font-size: 3.5vw;
      text-align: center;
      min-height: 2.5vh;
      flex-shrink: 0;
    }

    .content-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5vh;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="header">ğŸ– í†µë¹± í˜¸ì¶œë²¨ ğŸœ</div>
  
  <div id="displayStatus" class="status-disconnected">ë””ìŠ¤í”Œë ˆì´ ìƒíƒœ í™•ì¸ ì¤‘...</div>

  <div id="currentNumbers">í˜„ì¬ í˜¸ì¶œëœ ë²ˆí˜¸: ì—†ìŒ</div>

  <div class="content-wrapper">
    <div class="row">
      <input type="number" id="callNumber" class="input-short" placeholder="ë²ˆí˜¸" min="1" max="700" />
      <button class="btn-orange btn-flex" onclick="sendCall()">ğŸ“¢ í˜¸ì¶œ</button>
    </div>

    <div class="row">
      <input type="number" id="sequenceNumber" class="input-short" placeholder="ëë²ˆí˜¸" min="5" max="700" />
      <button class="btn-orange btn-flex" onclick="sendSequenceCall()">ğŸ“¢ ì—°ì† 5ê°œ í˜¸ì¶œ</button>
    </div>

    <button class="btn-red" onclick="clearAllNumbers()">ğŸ—‘ï¸ ëª¨ë“  í˜¸ì¶œë²ˆí˜¸ ì§€ìš°ê¸°</button>

    <button class="btn-orange" onclick="sendMessage('ì‚¼ê²¹ì‚´ë§Œ ì£¼ë¬¸í•˜ì‹  ë¶„ ë¨¼ì € ë“œë¦½ë‹ˆë‹¤')">ğŸ¥© ì‚¼ê²¹ì‚´ ë¨¼ì €</button>
    <button class="btn-orange" onclick="sendMessage('êµ­ìˆ˜ë§Œ ì£¼ë¬¸í•˜ì‹  ë¶„ ë¨¼ì € ë“œë¦½ë‹ˆë‹¤')">ğŸœ êµ­ìˆ˜ ë¨¼ì €</button>

    <div class="row">
      <input type="number" id="samTime" class="input-short" placeholder="ì‚¼ê²¹ì‚´" value="5" />
      <button class="btn-orange btn-flex" onclick="sendSamTime()">â± ì‚¼ê²¹ì‚´ ì‹œê°„</button>
    </div>
    <div class="row">
      <input type="number" id="noodleTime" class="input-short" placeholder="êµ­ìˆ˜" value="5" />
      <button class="btn-orange btn-flex" onclick="sendNoodleTime()">â± êµ­ìˆ˜ ì‹œê°„</button>
    </div>

    <button class="btn-gray" onclick="testDisplay()" style="background-color: #666;">ğŸ” ë””ìŠ¤í”Œë ˆì´ í…ŒìŠ¤íŠ¸</button>

    <div id="status">í˜¸ì¶œë²¨ ì‹œìŠ¤í…œ ì¤€ë¹„ë¨</div>
  </div>

  <audio id="alert" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhCSqW3/LNeCQEJoO+8+KVQQAJT6/h3rNSEwc7iNb94HQ7BQFM1O+9czCZvpyMnf3mgJFyRBFh3+/8JQEBS9XvuiEEAQECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJykqKywtLi8wMTIzNDU2Nzg5Ojs8PT4/QEFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaW1xdXl9gYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXp7fH1+f4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/AAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGxwdHh8gISIjJCUmJykqKywtLi8wMTIzNDU2Nzg5Ojs8PT4/QEFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaW1xdXl9gYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXp7fH1+f4CBgoOEhYaHiImKi4yNjo+QkZKTlJWWl5iZmpucnZ6foKGio6SlpqeoqaqrrK2ur7CxsrO0tba3uLm6u7y9vr/AwcLDxMXGx8jJysvMzc7P0NHS09TV1tfY2drb3N3e3+Dh4uPk5ebn6Onq6+zt7u/w8fLz9PX29/j5+vv8/f7/" preload="auto"></audio>

  <script>
    // âœ… ì›¹ì†Œì¼“ URLì„ ë™ì ìœ¼ë¡œ ìƒì„± (HTTP/HTTPS ìë™ ê°ì§€)
    const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
    const ws = new WebSocket(protocol + '//' + location.host);
    
    const statusBox = document.getElementById("status");
    const displayStatusBox = document.getElementById("displayStatus");
    const currentNumbersBox = document.getElementById("currentNumbers");
    let currentNumbers = [];
    let isDisplayConnected = false;

    ws.onopen = () => {
      console.log("ì›¹ì†Œì¼“ ì—°ê²°ë¨");
      ws.send("INPUT");
      setStatus("âœ… ì„œë²„ ì—°ê²°ë¨");
    };

    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        if (data.type === 'DISPLAY_ON') {
          isDisplayConnected = true;
          displayStatusBox.innerText = "âœ… ë””ìŠ¤í”Œë ˆì´ ì—°ê²°ë¨";
          displayStatusBox.className = "status-connected";
        } else if (data.type === 'DISPLAY_OFF') {
          isDisplayConnected = false;
          displayStatusBox.innerText = "âŒ ë””ìŠ¤í”Œë ˆì´ ì—°ê²° ëŠê¹€";
          displayStatusBox.className = "status-disconnected";
          playAlert();
        } else if (data.type === 'CALL' && Array.isArray(data.list)) {
          currentNumbers = data.list;
          updateCurrentNumbersDisplay();
        }
      } catch (e) {
        console.log("ë¹„JSON ë©”ì‹œì§€:", event.data);
      }
    };

    ws.onerror = () => {
      setStatus("âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    };

    ws.onclose = () => {
      setStatus("âš ï¸ ì„œë²„ ì—°ê²° ëŠê¹€");
    };

    function updateCurrentNumbersDisplay() {
      if (currentNumbers.length === 0) {
        currentNumbersBox.innerText = "í˜„ì¬ í˜¸ì¶œëœ ë²ˆí˜¸: ì—†ìŒ";
      } else {
        currentNumbersBox.innerText = `í˜„ì¬ í˜¸ì¶œëœ ë²ˆí˜¸: ${currentNumbers.join(', ')}`;
      }
    }

    function setStatus(msg) {
      statusBox.innerText = msg;
    }

    function playAlert() {
      const alert = document.getElementById("alert");
      if (alert) {
        alert.currentTime = 0;
        alert.play().catch(() => {});
      }
    }

    function checkDisplayAndNotify() {
      if (!isDisplayConnected) {
        setStatus("âš ï¸ ë””ìŠ¤í”Œë ˆì´ ì—°ê²° ëŠê¹€ - í˜¸ì¶œì´ ì „ë‹¬ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤");
        playAlert();
        return false;
      }
      return true;
    }

    function sendCall() {
      if (!checkDisplayAndNotify()) return;
      
      const num = parseInt(document.getElementById("callNumber").value);
      if (!isNaN(num) && num >= 1 && num <= 700) {
        ws.send(`CALL:${num}`);
        setStatus(`ğŸ“¢ ${num}ë²ˆ í˜¸ì¶œë¨`);
        document.getElementById("callNumber").value = '';
      }
    }

    function sendSequenceCall() {
      if (!checkDisplayAndNotify()) return;
      
      const endNum = parseInt(document.getElementById("sequenceNumber").value);
      if (!isNaN(endNum) && endNum >= 5 && endNum <= 700) {
        const startNum = endNum - 4;
        const sequence = [];
        for (let i = startNum; i <= endNum; i++) {
          sequence.push(i);
        }
        
        ws.send(`SEQUENCE:${sequence.join(',')}`);
        setStatus(`ğŸ“¢ ì—°ì† í˜¸ì¶œ: ${sequence.join(', ')}`);
        document.getElementById("sequenceNumber").value = '';
      } else {
        setStatus(`âŒ 5 ì´ìƒì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”`);
      }
    }

    function clearAllNumbers() {
      ws.send('CLEAR');
      setStatus('ğŸ—‘ï¸ ëª¨ë“  í˜¸ì¶œë²ˆí˜¸ ì§€ì›Œì§');
    }

    function sendMessage(text) {
      if (!checkDisplayAndNotify()) return;
      
      ws.send(`MSG:${text}`);
      setStatus(`ğŸ’¬ ë©”ì‹œì§€ ì „ì†¡: ${text}`);
    }

    function sendSamTime() {
      const sam = parseInt(document.getElementById("samTime").value);
      const noodle = parseInt(document.getElementById("noodleTime").value);
      if (!isNaN(sam) && !isNaN(noodle)) {
        ws.send(`TIME:${sam}:${noodle}`);
        setStatus(`â± ì‚¼ê²¹ì‚´ ì˜ˆìƒì‹œê°„: ${sam}ë¶„`);
      }
    }

    function sendNoodleTime() {
      const sam = parseInt(document.getElementById("samTime").value);
      const noodle = parseInt(document.getElementById("noodleTime").value);
      if (!isNaN(sam) && !isNaN(noodle)) {
        ws.send(`TIME:${sam}:${noodle}`);
        setStatus(`â± êµ­ìˆ˜ ì˜ˆìƒì‹œê°„: ${noodle}ë¶„`);
      }
    }
    
    function testDisplay() {
      ws.send(`MSG:ë””ìŠ¤í”Œë ˆì´ í…ŒìŠ¤íŠ¸ - ${new Date().getSeconds()}ì´ˆ`);
      setStatus("ğŸ” ë””ìŠ¤í”Œë ˆì´ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ë¨");
    }
  </script>
</body>
</html>