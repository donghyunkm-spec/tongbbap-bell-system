<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>í†µë¹± 1ë£¨ì  í˜¸ì¶œ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 1vh 2vw;
      margin: 0;
      background-color: #fff;
      color: #333;
      height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      font-size: 6vw;
      font-weight: bold;
      color: #e91e63;
      margin-bottom: 1vh;
    }

    button, input {
      font-size: 4.5vw;
      padding: 1.2vh 0;
      margin: 0.3vh 0;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      box-sizing: border-box;
    }

    button { width: 100%; cursor: pointer; }

    .btn-orange { background-color: orange; color: white; }
    .btn-gray { background-color: #ccc; color: #333; }
    .btn-red { background-color: #ff4444; color: white; }
    .btn-dark-red { background-color: #8b0000; color: white; margin-top: 2vh; padding: 2vh 0; }
    .btn-green { background-color: #28a745; color: white; margin-top: 1vh; padding: 1.5vh 0; }
    .btn-blue { background-color: #007bff; color: white; margin-top: 1vh; padding: 1.5vh 0; }
    .btn-purple { background-color: #6f42c1; color: white; }
    .btn-teal { background-color: #20c997; color: white; }
    .btn-indigo { background-color: #6610f2; color: white; }

    .btn-call {
      font-size: 6vw !important;
      padding: 2vh 0 !important;
      margin: 1vh 0 !important;
    }

    .row {
      display: flex;
      gap: 1.5vw;
      align-items: center;
      width: 100%;
    }

    .row-three-buttons {
      display: flex;
      gap: 1vw;
      align-items: center;
      width: 100%;
      margin-top: 1vh;
    }

    .btn-third {
      flex: 1;
      font-size: 3.5vw !important;
      padding: 1.5vh 0.5vw !important;
      margin: 0 !important;
    }

    .input-short {
      width: 22%;
      font-size: 4.5vw;
      text-align: center;
      border: 2px solid #ccc;
    }

    .btn-flex { flex: 1; }
    .btn-half { flex: 1; }

    #status {
      text-align: center;
      font-size: 5.5vw;
      color: #ff0000;
      font-weight: bold;
      margin: 1vh 0;
      padding: 1vh 2vw;
      min-height: 4vh;
      flex-shrink: 0;
      background-color: #ffe6e6;
      border-radius: 8px;
      border: 2px solid #ff6666;
    }

    #displayStatus {
      text-align: center;
      font-size: 4vw;
      font-weight: bold;
      min-height: 3vh;
      flex-shrink: 0;
      border-radius: 8px;
      padding: 0.5vh 1vw;
      margin-bottom: 0.5vh;
    }

    .status-connected { background-color: #d4edda; color: #155724; }
    .status-disconnected { background-color: #f8d7da; color: #721c24; }
    .status-reconnecting { background-color: #fff3cd; color: #856404; }

    #currentNumbers {
      background-color: #f0f0f0;
      padding: 1.5vh 2.5vw;
      border-radius: 6px;
      margin: 0.5vh 0;
      font-size: 5.5vw;
      text-align: center;
      min-height: 4vh;
      flex-shrink: 0;
      font-weight: bold;
      border: 3px solid #ddd;
    }

    #closedStatusNotice {
      background-color: #dc3545;
      color: white;
      padding: 1vh 2vw;
      border-radius: 6px;
      margin: 0.5vh 0;
      font-size: 4.5vw;
      text-align: center;
      font-weight: bold;
      border: 3px solid #a71e2a;
      display: none;
      animation: pulse 2s infinite;
    }

    #closedStatusNotice.show { display: block; }

    .content-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5vh;
      overflow-y: auto;
    }

    .pulse { animation: pulse 1.5s infinite; }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .offline-indicator {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: #dc3545;
      color: white;
      text-align: center;
      padding: 0.5vh;
      font-size: 3.5vw;
      z-index: 1000;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }

    .offline-indicator.show { transform: translateY(0); }

    .audio-buttons {
      display: flex;
      gap: 1vw;
      margin-bottom: 1vh;
    }

    .btn-audio {
      flex: 1;
      font-size: 4vw !important;
      padding: 1.2vh 0.5vw !important;
      margin: 0 !important;
    }

    .btn-menu-toggle {
      background-color: #28a745;
      color: white;
      transition: all 0.3s ease;
      font-size: 3.5vw;
      padding: 1.5vh 0.5vw;
    }

    .btn-menu-toggle.sold-out {
      background-color: #dc3545;
      text-decoration: line-through;
      opacity: 0.8;
    }

    .section-title {
      font-size: 4.5vw;
      font-weight: bold;
      margin: 1.5vh 0 0.5vh 0;
      color: #555;
      border-bottom: 2px solid #eee;
      padding-bottom: 0.5vh;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1vw;
    }
  </style>
</head>

<body>
  <div id="offlineIndicator" class="offline-indicator">
    ğŸ”„ ì„œë²„ ì¬ì—°ê²° ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”
  </div>

  <div class="header">ğŸ–– í†µë¹± 1ë£¨ì  í˜¸ì¶œë²¨ ğŸœ </div>

  <div id="displayStatus" class="status-disconnected">ë””ìŠ¤í”Œë ˆì´ ìƒíƒœ í™•ì¸ ì¤‘...</div>

  <div id="currentNumbers">í˜„ì¬ í˜¸ì¶œëœ ë²ˆí˜¸: ì—†ìŒ</div>

  <div id="closedStatusNotice">âš ï¸ ì¬ê³ ì†Œì§„ë§ˆê° ë¬¸êµ¬ í‘œì‹œì¤‘ âš ï¸</div>

  <div class="content-wrapper">
    <div class="row">
      <input type="number" id="callNumber" class="input-short" placeholder="ë²ˆí˜¸" min="1" max="700" />
      <button class="btn-orange btn-half btn-call" onclick="sendCall()">ğŸ“¢ í˜¸ì¶œ</button>
      <button class="btn-blue btn-half btn-call" onclick="sendCallPlusOne()">ğŸ“¢ í˜¸ì¶œ+1</button>
    </div>

    <div class="row">
      <input type="number" id="sequenceNumber" class="input-short" placeholder="ëë²ˆí˜¸" min="5" max="700" />
      <button class="btn-orange btn-flex" onclick="sendSequenceCall()">ğŸ“¢ ìµœê·¼ 5ê°œ í˜¸ì¶œ</button>
    </div>

    <div class="audio-buttons">
      <button class="btn-purple btn-audio" onclick="playAudio('monitor')">ğŸ–¥ï¸ ëª¨ë‹ˆí„°</button>
      <button class="btn-teal btn-audio" onclick="playAudio('noodle')">ğŸœ êµ­ìˆ˜</button>
      <button class="btn-indigo btn-audio" onclick="playAudio('pork')">ğŸ¥© ì‚¼ê²¹ì‚´</button>
    </div>

    <div class="section-title">ğŸš« ë©”ë‰´ í’ˆì ˆ ê´€ë¦¬</div>
    <div class="menu-grid">
      <button id="btn-menu-sausage" class="btn-menu-toggle" onclick="toggleMenu('ì†Œì‹œì§€ë‚˜ì´ˆ')">ì†Œì‹œì§€ë‚˜ì´ˆ</button>
      <button id="btn-menu-bibim" class="btn-menu-toggle" onclick="toggleMenu('ë¹„ë¹”ë©´')">ë¹„ë¹”ë©´</button>
      <button id="btn-menu-noodle" class="btn-menu-toggle" onclick="toggleMenu('ê¹€ì¹˜ë§ì´êµ­ìˆ˜')">ê¹€ì¹˜ë§ì´êµ­ìˆ˜</button>
      <button id="btn-menu-pork" class="btn-menu-toggle" onclick="toggleMenu('ì‚¼ê²¹ì‚´')">ì‚¼ê²¹ì‚´</button>
      <button id="btn-menu-udon" class="btn-menu-toggle" onclick="toggleMenu('ìš°ë™')">ìš°ë™</button>
      <button id="btn-menu-banquet" class="btn-menu-toggle" onclick="toggleMenu('ì”ì¹˜êµ­ìˆ˜')">ì”ì¹˜êµ­ìˆ˜</button>
    </div>

    <div class="section-title">ğŸ“ í…ìŠ¤íŠ¸ ì¶œë ¥</div>
    <div class="row">
      <input type="text" id="textMessage" class="input-short" style="flex: 2; text-align: left; padding-left: 2vw;"
        placeholder="ì¶œë ¥í•  í…ìŠ¤íŠ¸ ì…ë ¥" />
      <button class="btn-blue btn-flex" style="flex: 1;" onclick="sendTextMessage()">ì „ì†¡</button>
    </div>

    <button class="btn-red" onclick="clearAllNumbers()">ğŸ—‘ï¸ ëª¨ë“  í˜¸ì¶œë²ˆí˜¸ ì§€ìš°ê¸°</button>

    <div id="status">1ë£¨ì  í˜¸ì¶œë²¨ ì‹œìŠ¤í…œ ì¤€ë¹„ë¨</div>

    <div class="row">
      <button class="btn-orange btn-flex" onclick="setWaitingModeWithPassword()">ğŸ“º ëŒ€ê¸°í™”ë©´(í™ë³´í™”ë©´)</button>
      <button class="btn-orange btn-flex" onclick="setCallMode()">ğŸ“¢ í˜¸ì¶œí™”ë©´ ì‹œì‘</button>
    </div>

    <div class="row-three-buttons">
      <button class="btn-orange btn-third" onclick="sendClosedStatusMessageWithPassword()">âš ï¸ ì¬ê³ ì†Œì§„(ì‘ì€ë©”ì‹œì§€)</button>
      <button class="btn-green btn-third" onclick="sendDefaultStatusMessage()">ğŸ”„ ê¸°ë³¸ìƒíƒœ</button>
    </div>

    <button class="btn-dark-red" onclick="sendFullClosedMessageWithPassword()">ğŸš« ì¬ê³ ì†Œì§„ ë§ˆê° (ì „ì²´í™”ë©´)</button>
    <button class="btn-green" onclick="sendWelcomeMessage()">ğŸ”„ ê¸°ë³¸ ë©”ì‹œì§€ë¡œ ë³µêµ¬ (ì „ì²´í™”ë©´ ë§ˆê° í•´ì œ)</button>
  </div>

  <script>
    const STORE_CODE = '1ru';
    let isClosedStatusActive = false;
    let isDisplayConnected = false;
    let currentNumbers = [];
    let wsManager;

    function playAudio(type) {
      let statusMessage = '';

      switch (type) {
        case 'monitor': statusMessage = 'ğŸ–¥ï¸ ëª¨ë‹ˆí„° ìŒì„± ì „ì†¡'; break;
        case 'noodle': statusMessage = 'ğŸœ êµ­ìˆ˜ ìŒì„± ì „ì†¡'; break;
        case 'pork': statusMessage = 'ğŸ¥© ì‚¼ê²¹ì‚´ ìŒì„± ì „ì†¡'; break;
      }

      if (wsManager.send(`AUDIO:${type}`)) {
        setStatus(statusMessage);
        console.log(`ğŸ“¡ ${STORE_CODE} ${statusMessage}`);
      }
    }

    function checkPassword() {
      const password = prompt("í™”ë©´ ì „í™˜ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
      if (password === "1234") {
        return true;
      } else if (password !== null) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
      return false;
    }

    class WebSocketManager {
      constructor() {
        this.ws = null;
        this.reconnectTimer = null;
        this.reconnectAttempts = 0;
        this.maxReconnectAttempts = 50;
        this.reconnectInterval = 300000;
        this.heartbeatTimer = null;
        this.heartbeatInterval = 300000;
        this.lastPongTime = Date.now();
        this.isManualClose = false;

        this.initVisibilityHandling();
        this.connect();
      }

      initVisibilityHandling() {
        document.addEventListener('visibilitychange', () => {
          if (document.visibilityState === 'visible') {
            console.log(`ğŸ“± ${STORE_CODE} ì•±ì´ í¬ê·¸ë¼ìš´ë“œë¡œ ëŒì•„ì˜´`);
            this.handleForeground();
          } else {
            console.log(`ğŸ“± ${STORE_CODE} ì•±ì´ ë°±ê·¸ë¼ìš´ë“œë¡œ ì´ë™`);
            this.handleBackground();
          }
        });

        window.addEventListener('focus', () => {
          console.log(`ğŸ¯ ${STORE_CODE} í˜ì´ì§€ í¬ì»¤ìŠ¤ ë¨`);
          this.handleForeground();
        });

        window.addEventListener('blur', () => {
          console.log(`ğŸ˜´ ${STORE_CODE} í˜ì´ì§€ ë¸”ëŸ¬ ë¨`);
        });

        window.addEventListener('online', () => {
          console.log(`ğŸŒ ${STORE_CODE} ì¸í„°ë„· ì—°ê²°ë¨`);
          this.handleOnline();
        });

        window.addEventListener('offline', () => {
          console.log(`ğŸ”µ ${STORE_CODE} ì¸í„°ë„· ì—°ê²° ëŠê¹€`);
          this.handleOffline();
        });
      }

      handleForeground() {
        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
          console.log(`ğŸ”„ ${STORE_CODE} í¬ê·¸ë¼ìš´ë“œ ë³µê·€ - ì¬ì—°ê²° ì‹œë„`);
          this.reconnect();
        } else {
          this.sendHeartbeat();
        }
      }

      handleBackground() {}

      handleOnline() {
        this.hideOfflineIndicator();
        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
          this.reconnect();
        }
      }

      handleOffline() {
        this.showOfflineIndicator();
        this.stopHeartbeat();
      }

      connect() {
        if (this.reconnectTimer) {
          clearTimeout(this.reconnectTimer);
          this.reconnectTimer = null;
        }

        if (this.ws) {
          this.isManualClose = true;
          this.ws.close();
        }

        const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${location.host}`;

        console.log(`ğŸ”— ${STORE_CODE} WebSocket ì—°ê²° ì‹œë„ (${this.reconnectAttempts + 1}/${this.maxReconnectAttempts}):`, wsUrl);

        this.isManualClose = false;

        try {
          this.ws = new WebSocket(wsUrl);
          this.setupWebSocketEvents();
        } catch (error) {
          console.error(`âŒ ${STORE_CODE} WebSocket ìƒì„± ì‹¤íŒ¨:`, error);
          this.scheduleReconnect();
        }
      }

      setupWebSocketEvents() {
        this.ws.onopen = () => {
          console.log(`âœ… ${STORE_CODE} WebSocket ì—°ê²°ë¨`);
          this.reconnectAttempts = 0;
          this.ws.send(`INPUT:${STORE_CODE}`);
          this.hideOfflineIndicator();
          this.startHeartbeat();
          this.lastPongTime = Date.now();
          setStatus(`âœ… ${STORE_CODE} ì„œë²„ ì—°ê²°ë¨`);
        };

        this.ws.onmessage = (event) => {
          this.lastPongTime = Date.now();

          try {
            const data = JSON.parse(event.data);

            if (data.type === 'PONG') {
              console.log(`ğŸ“ ${STORE_CODE} Pong ë°›ìŒ`);
              return;
            }

            if (data.type === 'DISPLAY_ON') {
              isDisplayConnected = true;
              document.getElementById('displayStatus').innerText = `âœ… ${STORE_CODE} ë””ìŠ¤í”Œë ˆì´ ì—°ê²°ë¨`;
              document.getElementById('displayStatus').className = "status-connected";
            } else if (data.type === 'DISPLAY_OFF') {
              isDisplayConnected = false;
              document.getElementById('displayStatus').innerText = `âŒ ${STORE_CODE} ë””ìŠ¤í”Œë ˆì´ ì—°ê²° ëŠê¹€`;
              document.getElementById('displayStatus').className = "status-disconnected";
            } else if (data.type === 'CALL' && Array.isArray(data.list)) {
              currentNumbers = data.list;
              updateCurrentNumbersDisplay();
            } else if (data.type === 'MENU_UPDATE') {
              updateMenuButtons(data.soldOutMenus);
            }
          } catch (e) {
            console.log(`${STORE_CODE} ë¹„JSON ë©”ì‹œì§€:`, event.data);
          }
        };

        this.ws.onerror = (error) => {
          console.error(`âŒ ${STORE_CODE} WebSocket ì—ëŸ¬:`, error);
          setStatus(`âŒ ${STORE_CODE} ì„œë²„ ì—°ê²° ì‹¤íŒ¨`);
        };

        this.ws.onclose = (event) => {
          console.log(`âŒ ${STORE_CODE} WebSocket ì—°ê²° ëŠê¹€:`, event.code, event.reason);
          this.stopHeartbeat();

          if (!this.isManualClose) {
            setStatus(`âš ï¸ ${STORE_CODE} ì„œë²„ ì—°ê²° ëŠê¹€`);
            this.scheduleReconnect();
          }
        };
      }

      scheduleReconnect() {
        if (this.reconnectAttempts >= this.maxReconnectAttempts) {
          console.error(`âŒ ${STORE_CODE} ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ ì´ˆê³¼`);
          setStatus(`âŒ ${STORE_CODE} ì—°ê²° ì‹¤íŒ¨ - ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”`);
          return;
        }

        const delay = this.reconnectInterval;
        this.showOfflineIndicator();

        this.reconnectTimer = setTimeout(() => {
          this.reconnectAttempts++;
          this.reconnect();
        }, delay);
      }

      reconnect() {
        console.log(`ğŸ”„ ${STORE_CODE} ì¬ì—°ê²° ì‹œë„`);
        this.connect();
      }

      startHeartbeat() {
        this.stopHeartbeat();
        this.heartbeatTimer = setInterval(() => {
          this.sendHeartbeat();
        }, this.heartbeatInterval);
      }

      stopHeartbeat() {
        if (this.heartbeatTimer) {
          clearInterval(this.heartbeatTimer);
          this.heartbeatTimer = null;
        }
      }

      sendHeartbeat() {
        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
          console.log(`ğŸ’“ ${STORE_CODE} Ping ì „ì†¡`);
          this.ws.send(JSON.stringify({ type: 'PING' }));
        }
      }

      send(message) {
        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
          this.ws.send(message);
          return true;
        } else {
          console.warn(`âš ï¸ ${STORE_CODE} ì „ì†¡ ì‹¤íŒ¨: ì—°ê²° ì•ˆë¨`);
          setStatus(`âŒ ì„œë²„ ì—°ê²° ì•ˆë¨`);
          this.reconnect();
          return false;
        }
      }

      showOfflineIndicator() {
        document.getElementById('offlineIndicator').classList.add('show');
        document.getElementById('displayStatus').innerText = 'â—¯ ì—°ê²° ëŠê¹€';
        document.getElementById('displayStatus').className = 'status-disconnected';
      }

      hideOfflineIndicator() {
        document.getElementById('offlineIndicator').classList.remove('show');
      }

      destroy() {
        this.stopHeartbeat();
        if (this.reconnectTimer) clearTimeout(this.reconnectTimer);
        if (this.ws) {
          this.isManualClose = true;
          this.ws.close();
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      wsManager = new WebSocketManager();
    });

    function setStatus(msg) {
      const statusBox = document.getElementById('status');
      statusBox.innerText = msg;
      statusBox.style.animation = 'none';
      statusBox.offsetHeight;
      statusBox.style.animation = 'pulse 0.5s';
    }

    function updateCurrentNumbersDisplay() {
      const display = document.getElementById('currentNumbers');
      if (currentNumbers.length === 0) {
        display.innerText = "í˜„ì¬ í˜¸ì¶œëœ ë²ˆí˜¸: ì—†ìŒ";
      } else {
        const recent = currentNumbers.slice(-5);
        display.innerText = `í˜„ì¬ í˜¸ì¶œëœ ë²ˆí˜¸: ${recent.join(', ')}`;
      }
    }

    function sendCall() {
      const numberInput = document.getElementById('callNumber');
      const number = numberInput.value;

      if (!number) {
        alert("í˜¸ì¶œí•  ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      if (wsManager.send(`CALL:${number}`)) {
        setStatus(`ğŸ“¢ ${number}ë²ˆ í˜¸ì¶œ ì „ì†¡ë¨`);
        numberInput.value = '';
        numberInput.focus();
      }
    }

    function sendCallPlusOne() {
      const numberInput = document.getElementById('callNumber');
      let number = parseInt(numberInput.value);

      if (!number) {
        if (currentNumbers.length > 0) {
          number = parseInt(currentNumbers[currentNumbers.length - 1]) + 1;
        } else {
          alert("í˜¸ì¶œí•  ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }
      } else {
        number = number + 1;
      }

      if (wsManager.send(`CALL:${number}`)) {
        setStatus(`ğŸ“¢ ${number}ë²ˆ í˜¸ì¶œ ì „ì†¡ë¨`);
        numberInput.value = number;
        numberInput.focus();
      }
    }

    function sendSequenceCall() {
      const sequenceInput = document.getElementById('sequenceNumber');
      const endNumber = parseInt(sequenceInput.value);

      if (!endNumber) {
        alert("ëë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      const startNumber = Math.max(1, endNumber - 4);
      const confirmMsg = `${startNumber}ë²ˆë¶€í„° ${endNumber}ë²ˆê¹Œì§€ 5ê°œë¥¼ ì—°ì† í˜¸ì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
      
      if (!confirm(confirmMsg)) return;

      let current = startNumber;
      let count = 0;

      const interval = setInterval(() => {
        if (current > endNumber) {
          clearInterval(interval);
          setStatus(`âœ… ${startNumber}~${endNumber}ë²ˆ ì—°ì† í˜¸ì¶œ ì™„ë£Œ`);
          sequenceInput.value = '';
          return;
        }

        if (wsManager.send(`CALL:${current}`)) {
          setStatus(`ğŸ“¢ ${current}ë²ˆ í˜¸ì¶œ ì „ì†¡ë¨ (${++count}/5)`);
        }
        current++;
      }, 500);
    }

    function clearAllNumbers() {
      if (confirm("ëª¨ë“  í˜¸ì¶œ ë²ˆí˜¸ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        if (wsManager.send('CLEAR')) {
          setStatus("ğŸ—‘ï¸ ëª¨ë“  í˜¸ì¶œ ë²ˆí˜¸ ì‚­ì œë¨");
          currentNumbers = [];
          updateCurrentNumbersDisplay();
        }
      }
    }

    function setWaitingModeWithPassword() {
      if (!checkPassword()) return;

      if (wsManager.send('MODE:WAITING')) {
        setStatus("ğŸ“º ëŒ€ê¸°í™”ë©´ ëª¨ë“œë¡œ ì „í™˜ë¨");
      }
    }

    function setCallMode() {
      if (wsManager.send('MODE:CALL')) {
        setStatus("ğŸ“¢ í˜¸ì¶œí™”ë©´ ëª¨ë“œë¡œ ì „í™˜ë¨");
      }
    }

    function sendTextMessage() {
      const input = document.getElementById('textMessage');
      const text = input.value;

      if (!text) {
        alert("ì „ì†¡í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      if (wsManager.send(`MSG_DISPLAY:${text}|10000`)) {
        setStatus(`ğŸ“ í…ìŠ¤íŠ¸ ì „ì†¡: ${text}`);
        input.value = '';
      }
    }

    function toggleMenu(menuName) {
      if (wsManager.send(`TOGGLE_MENU:${menuName}`)) {
        // UI ì—…ë°ì´íŠ¸ëŠ” ì„œë²„ ì‘ë‹µ(MENU_UPDATE)ìœ¼ë¡œ ì²˜ë¦¬
      }
    }

    function updateMenuButtons(soldOutList) {
      const buttons = document.querySelectorAll('.btn-menu-toggle');
      buttons.forEach(btn => {
        const menuName = btn.getAttribute('onclick').match(/'([^']+)'/)[1];

        if (soldOutList.includes(menuName)) {
          btn.classList.add('sold-out');
          if (!btn.innerText.includes('(í’ˆì ˆ)')) {
            btn.innerText = btn.innerText + ' (í’ˆì ˆ)';
          }
        } else {
          btn.classList.remove('sold-out');
          btn.innerText = btn.innerText.replace(' (í’ˆì ˆ)', '');
        }
      });
    }

    function sendClosedStatusMessageWithPassword() {
      if (!checkPassword()) return;

      if (wsManager.send(`STATUS:ì¬ê³ ì†Œì§„ ë§ˆê°ì…ë‹ˆë‹¤. ì£„ì†¡í•©ë‹ˆë‹¤`)) {
        setStatus("âš ï¸ ì¬ê³ ì†Œì§„ ìƒíƒœ ë©”ì‹œì§€ ì „ì†¡ë¨");
        document.getElementById('closedStatusNotice').classList.add('show');
        isClosedStatusActive = true;
      }
    }

    function sendDefaultStatusMessage() {
      if (wsManager.send(`STATUS:ê¹€ì¹˜ë§ì´êµ­ìˆ˜ íŒë§¤ ì¤‘ì…ë‹ˆë‹¤`)) {
        setStatus("ğŸ”„ ê¸°ë³¸ ìƒíƒœ ë©”ì‹œì§€ë¡œ ë³µêµ¬ë¨");
        document.getElementById('closedStatusNotice').classList.remove('show');
        isClosedStatusActive = false;
      }
    }

    function sendFullClosedMessageWithPassword() {
      if (!checkPassword()) return;

      if (wsManager.send(`MSG:ê¸ˆì¼ ì¬ê³ ì†Œì§„ìœ¼ë¡œ ì¸í•´ ë§ˆê°í•©ë‹ˆë‹¤. ëŒ€ë‹¨íˆ ì£„ì†¡í•©ë‹ˆë‹¤.`)) {
        setStatus("ğŸš« ì „ì²´í™”ë©´ ë§ˆê° ë©”ì‹œì§€ ì „ì†¡ë¨");
      }
    }

    function sendWelcomeMessage() {
      if (wsManager.send(`MSG:ì•ˆë…•í•˜ì„¸ìš”! í†µë¹± ì…ë‹ˆë‹¤`)) {
        setStatus("ğŸ”„ ì „ì²´í™”ë©´ ë§ˆê° í•´ì œë¨");
      }
    }
  </script>
</body>

</html>